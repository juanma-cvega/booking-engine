@startuml
:roomCreatedEvent;
repeat
:CreateSlotUseCase|
->slotCreatedEvent;
fork
  :FindNextSlotStateUseCase|
  if (pre reservation needs slot?) then (yes)
    ->slotPreReservedEvent;
    :ReserveSlotUseCase|
  elseif (class needs slot?) then (yes)
    ->slotNeededForClassEvent;
    :ReserveSlotUseCase|
  elseif (auctionRequired?) then (yes)
    ->auctionRequiredEvent;
    :StartAuctionUseCase|
    ->auctionStartedEvent;
    :ScheduleFinishActionUseCase|
    -[dashed]->auctionFinishedEvent;
    (A)
    detach
    (A)
    -[dashed]->auctionFinishedEvent;
    :FinishAuctionUseCase|
    if (auctionWinnerFound?) then (yes)
      ->auctionWinnerFoundEvent;
      :ReserveSlotForAuctionWinnerUseCase|
      ->slotReservedEvent;
    else (no)
      ->auctionUnsuccessfulEvent;
      :MakeSlotAvailableUseCase|
      ->slotMadeAvailableEvent;
    endif
  else (no)
    ->slotReadyEvent;
    :MakeSlotAvailableUseCase|
  endif
  stop
fork again
  :ScheduleNextSlotUseCase|
  -[dashed]->slotRequiredEvent;
  (B)
  detach
  (B)
@enduml
